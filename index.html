<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <meta name="robots" content="noindex">

        <script type="text/javascript" src="./js/lib/matter-0.8.0.js"></script>
       
        <script src="js/lib/modernizr.custom.js"></script>
        <script src="js/lib/interact.min.js"></script>

        <link rel="stylesheet" href="./css/style.css" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/component.css" />
        <link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

        <script type="text/javascript" src="./js/MagicKeyboard.js"></script>

        <script>
        var keyboardX = 400;
        var keyboardY = 300;
        var keyboardSX = 450*800/1920;
        var keyboardSY = 100*600/1080;

        interact('.resize-drag')
          .draggable({
            onmove: window.dragMoveListener
          })
          .resizable({
            preserveAspectRatio: false,
            edges: { left: true, right: true, bottom: true, top: true }
          })
          .on('resizemove', function (event) {
            var target = event.target,
                x = (parseFloat(target.getAttribute('data-x')) || 0),
                y = (parseFloat(target.getAttribute('data-y')) || 0);

            // update the element's style
            target.style.width  = event.rect.width + 'px';
            target.style.height = event.rect.height + 'px';

            keyboardSX = event.rect.width  * 800 / 1920;
            keyboardSY = event.rect.height  * 600 / 1080;

            console.log('width='+keyboardSX+' height='+ keyboardSY);

            // translate when resizing from top or left edges
            x += event.deltaRect.left;
            y += event.deltaRect.top;

            target.style.webkitTransform = target.style.transform =
                'translate(' + x + 'px,' + y + 'px)';

            keyboardX = x * 800 / 1920 + keyboardSX / 2 +10;
            keyboardY = y * 600 / 1080 + keyboardSY / 2 +15;

            console.log('x='+keyboardX+' y='+ keyboardY);

            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);
            target.textContent = "Drag and Resize me over your keyboard. (size:" + Math.round(event.rect.width) + 'Ã—' + Math.round(event.rect.height) + ')';
          });

          interact('.draggable')
          .draggable({
            // enable inertial throwing
            inertia: true,
            // keep the element within the area of it's parent
            restrict: {
              restriction: "parent",
              endOnly: true,
              elementRect: { top: 0, left: 0, bottom: 50, right: 200 }
            },
            // enable autoScroll
            autoScroll: true,

            // call this function on every dragmove event
            onmove: dragMoveListener,
            // call this function on every dragend event
            onend: function (event) {}
          });

          function dragMoveListener (event) {

            $("#startPlay").fadeIn(2000);

            var target = event.target,
            // keep the dragged position in the data-x/data-y attributes
            x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
            y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

            keyboardX = x * 800 / 1920 + keyboardSX / 2+10;
            keyboardY = y * 600 / 1080 + keyboardSY / 2+15;

            console.log('x='+keyboardX+' y='+ keyboardY);
            // translate the element
            target.style.webkitTransform =
            target.style.transform =
              'translate(' + x + 'px, ' + y + 'px)';

            // update the posiion attributes
            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);

            target.textContent = "Drag and Resize me over your keyboard. (x:" + Math.round(keyboardX) + ' y:' + Math.round(keyboardY) + ')'
          }

          // this is used later in the resizing and gesture demos
          window.dragMoveListener = dragMoveListener;

          $(document).ready(function(){
            
            $("#preparation").hide();
            $("#calibration").hide();
            $(".resize-container").hide();
            $("#play").hide();
            $("#backToCalibration").hide();
            $("#keyboardLight").hide();


            $("#startPreparation").click(function(){
                $("#home").hide();
                $("#preparation").fadeIn(500);
            });

            $("#startCalibration").click(function(){
                $("#preparation").hide();
                $("#calibration").fadeIn(500);
                $("#startPlay").hide();
                $(".resize-container").fadeIn(500);
                
            });

            $("#startPlay").click(function(){
                $("#keyboardLight").css({   top: (keyboardY - keyboardSY/2)* 1080/600,
                                            left: (keyboardX - keyboardSX/2)* 1920/800,
                                            width: keyboardSX* 1920/800,
                                            height: keyboardSY* 1080/600 + 1,
                                            position:'absolute'});
                $("#keyboardLight_print").css({   top: (keyboardY - keyboardSY/2)* 1080/600,
                                            left: (keyboardX - keyboardSX/2)* 1920/800,
                                            width: keyboardSX* 1920/800,
                                            height: keyboardSY* 1080/600 + 1,
                                            position:'absolute'});
                $("#keyboardLight_print").fadeIn(500);
                $("#calibration").hide();
                $(".resize-container").hide();
                $("#play").fadeIn(500);                
                $("#backToCalibration").fadeIn(500);
            });

            $("#backToCalibration").click(function(){
                $("#calibration").fadeIn(500);
                $(".resize-container").fadeIn(500);
                $("#play").hide(); 
                $("#backToCalibration").fadeOut(500);
                $("#keyboardLight").hide();
                $("#keyboardLight_print").hide();
            });
        });

       </script>

        <title>Keybright 1.0 - Your DIY light installation</title>
    </head>
    <body>
    <audio id="sound1" src="sound/key1.ogg" preload="auto"></audio>
    <audio id="sound2" src="sound/key2.ogg" preload="auto"></audio> 
    <audio id="sound3" src="sound/key3.ogg" preload="auto"></audio> 

    <audio id="sound4" src="sound/space1.ogg" preload="auto"></audio>
    <audio id="sound5" src="sound/space2.ogg" preload="auto"></audio>

        <!--    TODO: 
                - Add jquery transitions between steps
                - Add calibration draggable/scalable/rotationable rectangle to Calib step
                - Test with projector
                - Make preparation background for preparation step

                IDEAS
                - Make game variations library
                - Open github commuity to create games and apps
                - Message: 'You have a projector at home? Let's take a few seconds to create a fun and original playground with a simple keyboard and some imagination !'

                GAMES
                - Incredible machine style
                - Casse brique
                - Type match
                - ...

        -->

        <!-- HOME -->
            <div id="home" class="slide">
                <h1>Welcome to Keybright 1.0</h1>
                <p>Build your own magical light installation in just a few clicks.</p>
                <button  class="btn btn-4 btn-4c icon-arrow-right" id="startPreparation">1. Let's go !</button>
            </div>

            <!--  PREPARATION - Grille de calibration en background -->
            <div id="preparation" class="slide">
                <h1>Preparation</h1>
                <p>Drag that Window to your projector screen. Press F11 to go fullscreen</p>
                <button class="btn btn-4 btn-4c icon-arrow-right" id="startCalibration">2. Calibrate Keyboard</button>
            </div>   

            <!--  CALIBRATION - Grille de calibration en background -->  
            <div id="calibration" class="slide no-border">
                 <h1>Calibration</h1>
                <button  class="btn btn-4 btn-4c icon-arrow-right" id="startPlay">3. Play !</button>
            </div>

        <!-- <div class="resize-container">
              <div id="calibrationRectangle" class="resize-drag draggable resizable">
                 Resize from any edge or corner
              </div>
        </div> -->
        <div class="resize-container">
          <div id="calibrationRectangle" class="resize-drag draggable">
             Drag and Resize me over your keyboard.
          </div>
        </div>
            <!--  PLAY -->  
            <button class="btn btn-4 btn-4b icon-arrow-left top-layer"  id="backToCalibration">Re-Calibrate</button>
            <div id="keyboardLight"></div>
            <div id="keyboardLight_print"></div>
            <div class="container" id="play">
                <div id="canvas-container">
                </div>
            </div>

             <script type="text/javascript">
             document.getElementById('canvas-container').visible = false;
            </script>
    </body>
</html>